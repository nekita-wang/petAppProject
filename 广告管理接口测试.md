# 广告管理接口测试文档

## 基础信息
- **服务地址**: http://localhost:8080
- **API前缀**: /advertisement/advertisement
- **测试工具**: Postman / curl / 浏览器

---

## 1. APP端广告展示接口（重点测试）

### 1.1 根据广告位获取运行中的广告
**接口说明**: 供APP端获取指定广告位的运行中广告，会自动增加点击量

```http
GET /advertisement/advertisement/running/{adPosition}
```

**请求参数**:
- `adPosition`: 广告位标识（1-6）

**测试用例**:

#### 测试用例1: 获取广告位1的广告
```bash
curl -X GET "http://localhost:8080/advertisement/advertisement/running/1" \
  -H "Content-Type: application/json"
```

#### 测试用例2: 获取广告位2的广告
```bash
curl -X GET "http://localhost:8080/advertisement/advertisement/running/2" \
  -H "Content-Type: application/json"
```

#### 测试用例3: 获取不存在的广告位
```bash
curl -X GET "http://localhost:8080/advertisement/advertisement/running/7" \
  -H "Content-Type: application/json"
```

**预期响应**:
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": {
    "id": 1,
    "adPosition": "1",
    "adName": "测试广告",
    "brand": "测试品牌",
    "status": 1,
    "clickCount": 10,
    "cleard": 0,
    "adRevenue": null,
    "revenueAttachment": null,
    "targetUrl": "https://example.com",
    "adImage": "/profile/advertisement/2025/01/02/test_ad.jpg",
    "adStartTime": "2025-01-01 00:00:00",
    "adEndTime": "2025-12-31 23:59:59",
    "createTime": "2025-01-02 10:00:00",
    "creator": "admin",
    "lastUpdateTime": "2025-01-02 15:30:00",
    "lastUpdater": "admin"
  }
}
```

---

## 2. 后台管理接口测试

### 2.1 获取广告列表
```bash
curl -X GET "http://localhost:8080/advertisement/advertisement/list" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json"
```

### 2.2 获取广告统计数据
```bash
curl -X GET "http://localhost:8080/advertisement/advertisement/statistics" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json"
```

### 2.3 新增广告
```bash
curl -X POST "http://localhost:8080/advertisement/advertisement" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "adPosition": "3",
    "adName": "新年促销广告",
    "brand": "宠物用品商城",
    "targetUrl": "https://petstore.example.com",
    "adImage": "/profile/advertisement/2025/01/02/new_year_ad.jpg",
    "adStartTime": "2025-01-01 00:00:00",
    "adEndTime": "2025-01-31 23:59:59"
  }'
```

### 2.4 失效广告
```bash
curl -X PUT "http://localhost:8080/advertisement/advertisement/invalidate/1" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json"
```

### 2.5 结清广告
```bash
curl -X PUT "http://localhost:8080/advertisement/advertisement/clearance" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "id": 1,
    "adRevenue": 1000.00,
    "revenueAttachment": "/profile/advertisement/2025/01/02/payment_screenshot.jpg"
  }'
```

---

## 3. 测试数据准备

### 3.1 创建测试广告数据
在数据库中插入测试数据：

```sql
INSERT INTO advertisement (
  ad_position, ad_name, brand, status, click_count, cleard, 
  target_url, ad_image, ad_start_time, ad_end_time, 
  create_time, creator, last_update_time, last_updater
) VALUES 
('1', '宠物食品广告', '皇家宠物食品', 1, 0, 0, 
 'https://royal-canin.example.com', '/profile/advertisement/2025/01/02/royal_canin.jpg', 
 '2025-01-01 00:00:00', '2025-12-31 23:59:59', 
 NOW(), 'admin', NOW(), 'admin'),
('2', '宠物玩具广告', '趣味宠物玩具', 1, 0, 0, 
 'https://pet-toys.example.com', '/profile/advertisement/2025/01/02/pet_toys.jpg', 
 '2025-01-01 00:00:00', '2025-12-31 23:59:59', 
 NOW(), 'admin', NOW(), 'admin');
```

---

## 4. 测试场景

### 4.1 APP端广告展示测试场景

#### 场景1: 正常获取广告
1. 访问 `GET /advertisement/advertisement/running/1`
2. 验证返回广告数据
3. 再次访问同一接口
4. 验证点击量是否增加

#### 场景2: 广告时间有效性测试
1. 创建一个已过期的广告
2. 访问该广告位
3. 验证不返回过期广告

#### 场景3: 广告状态测试
1. 创建一个已失效的广告
2. 访问该广告位
3. 验证不返回失效广告

### 4.2 后台管理测试场景

#### 场景1: 广告生命周期测试
1. 新增广告 → 运行中状态
2. 失效广告 → 已失效状态
3. 验证状态流转正确

#### 场景2: 广告收入管理测试
1. 创建运行中广告
2. 结清广告（填写收入和截图）
3. 验证状态变为已结清

---

## 5. 浏览器测试

### 5.1 直接浏览器访问（APP端接口）
```
http://localhost:8080/advertisement/advertisement/running/1
http://localhost:8080/advertisement/advertisement/running/2
http://localhost:8080/advertisement/advertisement/running/3
```

### 5.2 查看广告图片
```
http://localhost:8080/profile/advertisement/2025/01/02/your_image.jpg
```

---

## 6. 测试检查点

### 6.1 APP端接口检查点
- ✅ 接口无需认证（@Anonymous）
- ✅ 返回运行中且在有效期内的广告
- ✅ 自动增加点击量
- ✅ 广告图片路径正确
- ✅ 目标链接可访问

### 6.2 后台管理接口检查点
- ✅ 需要管理员权限认证
- ✅ 状态流转逻辑正确
- ✅ 业务规则验证有效
- ✅ 数据统计准确

---

## 7. 常见问题排查

### 7.1 接口返回401
- 检查是否需要登录token
- 确认用户权限

### 7.2 接口返回404
- 检查URL路径是否正确
- 确认服务是否启动

### 7.3 广告不显示
- 检查广告状态是否为运行中(1)
- 检查广告时间是否在有效期内
- 检查广告位是否正确
