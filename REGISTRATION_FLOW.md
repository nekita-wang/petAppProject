# 分步注册流程说明

## 概述

新的注册流程分为两个步骤：

1. **验证码校验**：校验手机号和验证码，不创建用户
2. **分步注册**：提交个人资料和可选的宠物信息，创建用户

## 接口说明

### 1. 发送验证码

```
POST /app/auth/sendCode
```

- 功能：发送验证码到指定手机号
- 参数：`SendCodeDTO`（包含手机号）
- 返回：验证码（开发环境）

### 2. 验证码校验（分步注册第一步）

```
POST /app/auth/verifyCode
```

- 功能：校验验证码，不创建用户
- 参数：`VerifyCodeDTO`（包含手机号和验证码）
- 返回：临时 token
- **重要**：验证码校验通过后，用户仍未注册，需要继续完成个人资料填写

### 3. 分步注册（分步注册第二步）

```
POST /app/auth/stepRegister
```

- 功能：提交个人资料和可选的宠物信息，创建用户
- 参数：`StepRegisterDTO`（包含个人资料和可选的宠物信息列表）
- 返回：`AuthUserInfo`（包含登录 token）
- **重要**：只有调用此接口才会真正创建用户

### 4. 跳过宠物信息（可选）

```
POST /app/pet/skipPet
```

- 功能：确认跳过宠物信息填写
- 参数：无
- 返回：成功响应

## 注册流程

### 场景 1：验证码通过后，未填写个人资料

1. 用户输入手机号，获取验证码
2. 用户输入验证码，调用 `/verifyCode` 接口
3. 验证码校验通过，返回临时 token
4. **用户未继续填写个人资料，直接退出**
5. **结果**：用户未注册，数据库中无用户记录

### 场景 2：验证码通过后，填写个人资料但跳过宠物信息

1. 用户输入手机号，获取验证码
2. 用户输入验证码，调用 `/verifyCode` 接口
3. 验证码校验通过，返回临时 token
4. 用户填写个人资料，调用 `/stepRegister` 接口（pets 字段为空或 null）
5. 系统创建用户，跳过宠物信息处理
6. 返回登录 token，跳转首页
7. **结果**：用户注册成功，无宠物信息

### 场景 3：验证码通过后，填写个人资料和宠物信息

1. 用户输入手机号，获取验证码
2. 用户输入验证码，调用 `/verifyCode` 接口
3. 验证码校验通过，返回临时 token
4. 用户填写个人资料和宠物信息，调用 `/stepRegister` 接口（pets 字段包含宠物信息）
5. 系统创建用户和宠物信息
6. 返回登录 token，跳转首页
7. **结果**：用户注册成功，包含宠物信息

## 关键特性

1. **验证码校验不创建用户**：`/verifyCode` 接口只校验验证码，不插入用户记录
2. **个人资料必填**：`/stepRegister` 接口要求个人资料完整填写
3. **宠物信息可选**：宠物信息可以为空，用户可以选择跳过
4. **一次性注册**：个人资料和宠物信息在同一个接口中处理，确保数据一致性

## 前端实现建议

1. **分步界面**：

   - 第一步：手机号 + 验证码
   - 第二步：个人资料 + 宠物信息（可选）

2. **流程控制**：

   - 验证码校验通过后，进入个人资料填写页面
   - 个人资料填写完成后，询问是否填写宠物信息
   - 用户可以选择"跳过"或"添加宠物"

3. **数据提交**：
   - 个人资料和宠物信息一起提交到 `/stepRegister` 接口
   - 如果用户选择跳过宠物信息，pets 字段传空数组或 null

